<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Hệ thống đặt lịch thông minh với AI - Quản lý công việc, đồng bộ lịch và tối ưu thời gian">
  <title>Smart Scheduler - Hệ thống đặt lịch thông minh</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Day.js for date manipulation -->
  <script src="https://unpkg.com/dayjs@1.11.7/dayjs.min.js"></script>
  
  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            secondary: '#6C63FF',
            success: '#48BB78',
            warning: '#ED8936',
            danger: '#F56565',
            light: '#F7FAFC',
            dark: '#1A202C',
          }
        }
      }
    };
    
    // Dark mode detection
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
  
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #CBD5E0;
      border-radius: 3px;
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: #4A5568;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    /* Calendar styling */
    .calendar-day {
      min-height: 80px;
      transition: all 0.2s ease;
    }
    
    .calendar-day:hover {
      background-color: rgba(93, 92, 222, 0.1);
    }
    
    .dark .calendar-day:hover {
      background-color: rgba(93, 92, 222, 0.2);
    }
    
    .task-item {
      transition: all 0.2s ease;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .task-item:hover {
      transform: translateY(-2px);
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
  <div id="root"></div>
  
  <script type="text/babel">
    // React Components
    const { useState, useEffect, useRef, useCallback } = React;
    
    // Main App Component
    const App = () => {
      const [activeTab, setActiveTab] = useState('tasks');
      const [tasks, setTasks] = useState([]);
      const [events, setEvents] = useState([]);
      const [currentDate, setCurrentDate] = useState(dayjs());
      const [calendarView, setCalendarView] = useState('week');
      const [isListening, setIsListening] = useState(false);
      const [aiAssistantResponse, setAiAssistantResponse] = useState('');
      const [isAiLoading, setIsAiLoading] = useState(false);
      const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
      const [notifications, setNotifications] = useState([]);
      const [showAddTask, setShowAddTask] = useState(false);
      const [showAddEvent, setShowAddEvent] = useState(false);
      const [newTask, setNewTask] = useState({ title: '', description: '', dueDate: '', priority: 'medium' });
      const [newEvent, setNewEvent] = useState({ title: '', description: '', startDate: '', endDate: '', location: '' });
      const [isDarkMode, setIsDarkMode] = useState(document.documentElement.classList.contains('dark'));
      
      // Simulated data for calendar sync
      const syncedCalendars = [
        { id: 1, name: 'Google Calendar', color: '#4285F4', connected: true },
        { id: 2, name: 'Outlook Calendar', color: '#0078D4', connected: false }
      ];
      
      // Demo tasks and events
      useEffect(() => {
        const demoTasks = [
          { id: 1, title: 'Hoàn thành báo cáo quý', description: 'Tổng hợp số liệu và hoàn thành báo cáo quý 2', dueDate: dayjs().add(2, 'day').format('YYYY-MM-DD'), priority: 'high', completed: false },
          { id: 2, title: 'Họp team phát triển', description: 'Thảo luận về tiến độ dự án mới', dueDate: dayjs().format('YYYY-MM-DD'), priority: 'medium', completed: false },
          { id: 3, title: 'Gym và tập luyện', description: 'Lịch tập luyện hàng ngày', dueDate: dayjs().add(1, 'day').format('YYYY-MM-DD'), priority: 'low', completed: true },
        ];
        
        const demoEvents = [
          { id: 1, title: 'Cuộc họp với khách hàng', description: 'Thảo luận về yêu cầu dự án', startDate: dayjs().hour(10).minute(0).format('YYYY-MM-DDTHH:mm'), endDate: dayjs().hour(11).minute(30).format('YYYY-MM-DDTHH:mm'), location: 'Văn phòng trung tâm' },
          { id: 2, title: 'Đào tạo nội bộ', description: 'Đào tạo về công nghệ mới', startDate: dayjs().add(1, 'day').hour(14).minute(0).format('YYYY-MM-DDTHH:mm'), endDate: dayjs().add(1, 'day').hour(16).minute(0).format('YYYY-MM-DDTHH:mm'), location: 'Phòng họp A' },
          { id: 3, title: 'Sinh nhật đồng nghiệp', description: 'Tiệc sinh nhật', startDate: dayjs().add(3, 'day').hour(18).minute(0).format('YYYY-MM-DDTHH:mm'), endDate: dayjs().add(3, 'day').hour(20).minute(0).format('YYYY-MM-DDTHH:mm'), location: 'Nhà hàng XYZ' },
        ];
        
        setTasks(demoTasks);
        setEvents(demoEvents);
        
        // Demo notifications
        setNotifications([
          { id: 1, title: 'Nhắc nhở: Họp team phát triển', time: 'Hôm nay, 14:00', read: false },
          { id: 2, title: 'Cuộc họp với khách hàng sắp bắt đầu', time: 'Sau 30 phút', read: true },
        ]);
        
      }, []);
      
      // Toggle dark mode
      const toggleDarkMode = () => {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          setIsDarkMode(false);
        } else {
          document.documentElement.classList.add('dark');
          setIsDarkMode(true);
        }
      };
      
      // Add task handler
      const handleAddTask = () => {
        if (!newTask.title) return;
        
        const task = {
          id: tasks.length + 1,
          ...newTask,
          completed: false
        };
        
        setTasks([...tasks, task]);
        setNewTask({ title: '', description: '', dueDate: '', priority: 'medium' });
        setShowAddTask(false);
      };
      
      // Add event handler
      const handleAddEvent = () => {
        if (!newEvent.title || !newEvent.startDate || !newEvent.endDate) return;
        
        const event = {
          id: events.length + 1,
          ...newEvent
        };
        
        setEvents([...events, event]);
        setNewEvent({ title: '', description: '', startDate: '', endDate: '', location: '' });
        setShowAddEvent(false);
      };
      
      // Task completion toggle
      const toggleTaskCompletion = (id) => {
        setTasks(tasks.map(task => 
          task.id === id ? { ...task, completed: !task.completed } : task
        ));
      };
      
      // Delete task
      const deleteTask = (id) => {
        setTasks(tasks.filter(task => task.id !== id));
      };
      
      // Delete event
      const deleteEvent = (id) => {
        setEvents(events.filter(event => event.id !== id));
      };
      
      // Calendar navigation
      const nextPeriod = () => {
        if (calendarView === 'day') {
          setCurrentDate(currentDate.add(1, 'day'));
        } else if (calendarView === 'week') {
          setCurrentDate(currentDate.add(1, 'week'));
        } else if (calendarView === 'month') {
          setCurrentDate(currentDate.add(1, 'month'));
        }
      };
      
      const prevPeriod = () => {
        if (calendarView === 'day') {
          setCurrentDate(currentDate.subtract(1, 'day'));
        } else if (calendarView === 'week') {
          setCurrentDate(currentDate.subtract(1, 'week'));
        } else if (calendarView === 'month') {
          setCurrentDate(currentDate.subtract(1, 'month'));
        }
      };
      
      const goToToday = () => {
        setCurrentDate(dayjs());
      };
      
      // Voice command handling
      const startListening = () => {
        if (!('webkitSpeechRecognition' in window)) {
          alert('Trình duyệt của bạn không hỗ trợ nhận dạng giọng nói. Vui lòng thử Chrome hoặc Edge.');
          return;
        }
        
        setIsListening(true);
        
        // Simulate voice recognition after 3 seconds
        setTimeout(() => {
          setIsListening(false);
          
          // Simulate processing and adding a task via voice
          const voiceTask = {
            id: tasks.length + 1,
            title: 'Gọi điện cho khách hàng',
            description: 'Thêm bằng giọng nói',
            dueDate: dayjs().add(1, 'day').format('YYYY-MM-DD'),
            priority: 'medium',
            completed: false
          };
          
          setTasks([...tasks, voiceTask]);
          
          // Show notification
          setNotifications([
            {
              id: Date.now(),
              title: 'Đã thêm công việc mới bằng giọng nói',
              time: 'Vừa xong',
              read: false
            },
            ...notifications
          ]);
          
        }, 3000);
      };
      
      // AI suggestions handler
      const getAiSuggestions = async () => {
        if (!window.Poe) {
          alert("Poe API không khả dụng trong môi trường này.");
          return;
        }
        
        setIsAiLoading(true);
        setAiAssistantResponse('');
        
        try {
          // Register handler for receiving responses
          window.Poe.registerHandler("ai-suggestion-handler", (result) => {
            const response = result.responses[0];
            
            if (response.status === "error") {
              setAiAssistantResponse("Đã xảy ra lỗi: " + (response.statusText || "Không thể kết nối với AI"));
              setIsAiLoading(false);
            } else if (response.status === "incomplete") {
              setAiAssistantResponse(response.content);
            } else if (response.status === "complete") {
              setAiAssistantResponse(response.content);
              setIsAiLoading(false);
            }
          });
          
          // Prepare task data for the prompt
          const taskData = tasks.map(task => ({
            title: task.title,
            priority: task.priority,
            dueDate: task.dueDate,
            completed: task.completed
          }));
          
          const eventData = events.map(event => ({
            title: event.title,
            start: event.startDate,
            end: event.endDate
          }));
          
          // Send request to Claude
          await window.Poe.sendUserMessage(
            `@Claude-3.7-Sonnet Dựa trên danh sách công việc và sự kiện dưới đây, hãy đề xuất cách tối ưu hóa lịch trình và sắp xếp công việc hiệu quả hơn. Trả lời bằng tiếng Việt, ngắn gọn trong khoảng 3-4 gạch đầu dòng.
            
            Công việc: ${JSON.stringify(taskData)}
            Sự kiện: ${JSON.stringify(eventData)}`,
            {
              handler: "ai-suggestion-handler",
              stream: true,
              openChat: false
            }
          );
        } catch (err) {
          setAiAssistantResponse("Lỗi kết nối: " + err.message);
          setIsAiLoading(false);
        }
      };
      
      // Calendar rendering helpers
      const getDaysInMonth = () => {
        const firstDayOfMonth = currentDate.startOf('month');
        const daysInMonth = currentDate.daysInMonth();
        
        // Get day of week for the first day (0 is Sunday)
        const firstDayOfWeek = firstDayOfMonth.day();
        
        const days = [];
        // Add empty cells for days before the first day of month
        for (let i = 0; i < firstDayOfWeek; i++) {
          days.push(null);
        }
        
        // Add days of the month
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(dayjs(firstDayOfMonth).date(i));
        }
        
        return days;
      };
      
      const getDaysInWeek = () => {
        const startOfWeek = currentDate.startOf('week');
        const days = [];
        
        for (let i = 0; i < 7; i++) {
          days.push(dayjs(startOfWeek).add(i, 'day'));
        }
        
        return days;
      };
      
      const getEventsForDay = (day) => {
        return events.filter(event => {
          const eventStart = dayjs(event.startDate);
          return eventStart.format('YYYY-MM-DD') === day.format('YYYY-MM-DD');
        });
      };
      
      const getTasksForDay = (day) => {
        return tasks.filter(task => {
          return task.dueDate === day.format('YYYY-MM-DD');
        });
      };
      
      // Render Calendar View
      const renderCalendar = () => {
        let days = [];
        let calendarTitle = '';
        
        if (calendarView === 'month') {
          days = getDaysInMonth();
          calendarTitle = currentDate.format('MMMM YYYY');
        } else if (calendarView === 'week') {
          days = getDaysInWeek();
          calendarTitle = `${days[0].format('DD/MM')} - ${days[6].format('DD/MM/YYYY')}`;
        } else {
          days = [currentDate];
          calendarTitle = currentDate.format('DD/MM/YYYY');
        }
        
        return (
          <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4 animate-fadeIn">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold">{calendarTitle}</h2>
              <div className="flex items-center">
                <button 
                  onClick={() => setCalendarView('day')} 
                  className={`px-2 py-1 mr-1 rounded ${calendarView === 'day' ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-gray-700'}`}
                >
                  Ngày
                </button>
                <button 
                  onClick={() => setCalendarView('week')} 
                  className={`px-2 py-1 mr-1 rounded ${calendarView === 'week' ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-gray-700'}`}
                >
                  Tuần
                </button>
                <button 
                  onClick={() => setCalendarView('month')} 
                  className={`px-2 py-1 rounded ${calendarView === 'month' ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-gray-700'}`}
                >
                  Tháng
                </button>
              </div>
            </div>
            
            <div className="flex items-center justify-between mb-4">
              <button onClick={prevPeriod} className="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                <i className="fas fa-chevron-left"></i>
              </button>
              <button onClick={goToToday} className="px-3 py-1 bg-primary text-white rounded">
                Hôm nay
              </button>
              <button onClick={nextPeriod} className="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                <i className="fas fa-chevron-right"></i>
              </button>
            </div>
            
            {/* Calendar grid */}
            <div className={`grid gap-1 ${calendarView === 'month' ? 'grid-cols-7' : calendarView === 'week' ? 'grid-cols-7' : 'grid-cols-1'}`}>
              {/* Weekday headers */}
              {calendarView !== 'day' && (
                <>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">CN</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T2</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T3</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T4</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T5</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T6</div>
                  <div className="text-center font-medium text-gray-600 dark:text-gray-400">T7</div>
                </>
              )}
              
              {/* Calendar days */}
              {days.map((day, index) => {
                if (!day) {
                  return <div key={`empty-${index}`} className="calendar-day"></div>;
                }
                
                const isToday = day.format('YYYY-MM-DD') === dayjs().format('YYYY-MM-DD');
                const dayEvents = getEventsForDay(day);
                const dayTasks = getTasksForDay(day);
                
                return (
                  <div 
                    key={day.format('YYYY-MM-DD')} 
                    className={`calendar-day p-1 border rounded-md ${isToday ? 'border-primary bg-blue-50 dark:bg-blue-900/20' : 'border-gray-200 dark:border-gray-700'}`}
                  >
                    <div className={`text-right mb-1 font-medium ${isToday ? 'text-primary' : ''}`}>
                      {day.format('D')}
                    </div>
                    
                    <div className="overflow-y-auto max-h-24">
                      {dayEvents.slice(0, 2).map(event => (
                        <div 
                          key={`event-${event.id}`} 
                          className="task-item text-xs p-1 mb-1 rounded bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200"
                          title={event.title}
                        >
                          <i className="fas fa-calendar-day mr-1"></i>
                          {event.title}
                        </div>
                      ))}
                      
                      {dayTasks.slice(0, 2).map(task => (
                        <div 
                          key={`task-${task.id}`} 
                          className={`task-item text-xs p-1 mb-1 rounded 
                            ${task.priority === 'high' ? 'bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-200' : 
                              task.priority === 'medium' ? 'bg-yellow-100 dark:bg-yellow-900/40 text-yellow-800 dark:text-yellow-200' : 
                                'bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-200'
                            }
                            ${task.completed ? 'line-through opacity-50' : ''}
                          `}
                          title={task.title}
                        >
                          <i className="fas fa-tasks mr-1"></i>
                          {task.title}
                        </div>
                      ))}
                      
                      {(dayEvents.length + dayTasks.length) > 4 && (
                        <div className="text-xs text-center text-gray-500 dark:text-gray-400">
                          +{dayEvents.length + dayTasks.length - 4} khác
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        );
      };
      
      // Render Task List
      const renderTasks = () => (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4 animate-fadeIn">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-semibold">Danh sách công việc</h2>
            <button 
              onClick={() => setShowAddTask(!showAddTask)} 
              className="px-3 py-1 bg-primary text-white rounded flex items-center"
            >
              <i className={`fas ${showAddTask ? 'fa-minus' : 'fa-plus'} mr-1`}></i>
              {showAddTask ? 'Hủy' : 'Thêm'}
            </button>
          </div>
          
          {showAddTask && (
            <div className="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg mb-4 animate-fadeIn">
              <div className="mb-2">
                <label className="block text-sm font-medium mb-1">Tiêu đề</label>
                <input 
                  type="text" 
                  className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                  placeholder="Nhập tiêu đề công việc" 
                  value={newTask.title}
                  onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                />
              </div>
              
              <div className="mb-2">
                <label className="block text-sm font-medium mb-1">Mô tả</label>
                <textarea 
                  className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                  placeholder="Mô tả chi tiết" 
                  value={newTask.description}
                  onChange={(e) => setNewTask({...newTask, description: e.target.value})}
                ></textarea>
              </div>
              
              <div className="grid grid-cols-2 gap-2 mb-2">
                <div>
                  <label className="block text-sm font-medium mb-1">Ngày hạn</label>
                  <input 
                    type="date" 
                    className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                    value={newTask.dueDate}
                    onChange={(e) => setNewTask({...newTask, dueDate: e.target.value})}
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium mb-1">Độ ưu tiên</label>
                  <select 
                    className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                    value={newTask.priority}
                    onChange={(e) => setNewTask({...newTask, priority: e.target.value})}
                  >
                    <option value="low">Thấp</option>
                    <option value="medium">Trung bình</option>
                    <option value="high">Cao</option>
                  </select>
                </div>
              </div>
              
              <button 
                onClick={handleAddTask}
                className="w-full py-2 bg-primary text-white rounded-lg hover:bg-primary/90"
              >
                Thêm công việc
              </button>
            </div>
          )}
          
          <div className="flex mb-2">
            <button className="mr-2 px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded">Tất cả</button>
            <button className="mr-2 px-3 py-1 rounded">Hôm nay</button>
            <button className="px-3 py-1 rounded">Sắp đến hạn</button>
          </div>
          
          <div className="divide-y divide-gray-200 dark:divide-gray-700">
            {tasks.length === 0 ? (
              <div className="py-4 text-center text-gray-500 dark:text-gray-400">
                Không có công việc nào. Thêm công việc mới để bắt đầu.
              </div>
            ) : (
              tasks.map(task => (
                <div key={task.id} className="py-3 flex items-start animate-fadeIn">
                  <input 
                    type="checkbox" 
                    checked={task.completed}
                    onChange={() => toggleTaskCompletion(task.id)}
                    className="mt-1 mr-3 h-5 w-5 text-primary rounded focus:ring-primary"
                  />
                  
                  <div className="flex-1">
                    <div className={`font-medium ${task.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}`}>
                      {task.title}
                    </div>
                    
                    <div className="text-sm text-gray-600 dark:text-gray-400">
                      {task.description}
                    </div>
                    
                    <div className="mt-1 flex items-center">
                      <span className={`text-xs px-2 py-0.5 rounded-full mr-2
                        ${task.priority === 'high' ? 'bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200' : 
                          task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-200' : 
                            'bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200'
                        }`}
                      >
                        {task.priority === 'high' ? 'Cao' : task.priority === 'medium' ? 'Trung bình' : 'Thấp'}
                      </span>
                      
                      <span className="text-xs text-gray-600 dark:text-gray-400">
                        <i className="far fa-calendar-alt mr-1"></i>
                        {dayjs(task.dueDate).format('DD/MM/YYYY')}
                      </span>
                    </div>
                  </div>
                  
                  <button 
                    onClick={() => deleteTask(task.id)}
                    className="text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400"
                  >
                    <i className="fas fa-trash-alt"></i>
                  </button>
                </div>
              ))
            )}
          </div>
        </div>
      );
      
      // Render Event List
      const renderEvents = () => (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4 animate-fadeIn">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-semibold">Sự kiện</h2>
            <button 
              onClick={() => setShowAddEvent(!showAddEvent)} 
              className="px-3 py-1 bg-primary text-white rounded flex items-center"
            >
              <i className={`fas ${showAddEvent ? 'fa-minus' : 'fa-plus'} mr-1`}></i>
              {showAddEvent ? 'Hủy' : 'Thêm'}
            </button>
          </div>
          
          {showAddEvent && (
            <div className="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg mb-4 animate-fadeIn">
              <div className="mb-2">
                <label className="block text-sm font-medium mb-1">Tiêu đề</label>
                <input 
                  type="text" 
                  className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                  placeholder="Nhập tiêu đề sự kiện" 
                  value={newEvent.title}
                  onChange={(e) => setNewEvent({...newEvent, title: e.target.value})}
                />
              </div>
              
              <div className="mb-2">
                <label className="block text-sm font-medium mb-1">Mô tả</label>
                <textarea 
                  className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                  placeholder="Mô tả chi tiết" 
                  value={newEvent.description}
                  onChange={(e) => setNewEvent({...newEvent, description: e.target.value})}
                ></textarea>
              </div>
              
              <div className="grid grid-cols-2 gap-2 mb-2">
                <div>
                  <label className="block text-sm font-medium mb-1">Bắt đầu</label>
                  <input 
                    type="datetime-local" 
                    className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                    value={newEvent.startDate}
                    onChange={(e) => setNewEvent({...newEvent, startDate: e.target.value})}
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium mb-1">Kết thúc</label>
                  <input 
                    type="datetime-local" 
                    className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                    value={newEvent.endDate}
                    onChange={(e) => setNewEvent({...newEvent, endDate: e.target.value})}
                  />
                </div>
              </div>
              
              <div className="mb-3">
                <label className="block text-sm font-medium mb-1">Địa điểm</label>
                <input 
                  type="text" 
                  className="w-full px-3 py-2 border rounded-lg text-base dark:bg-gray-800 dark:border-gray-600"
                  placeholder="Nhập địa điểm" 
                  value={newEvent.location}
                  onChange={(e) => setNewEvent({...newEvent, location: e.target.value})}
                />
              </div>
              
              <button 
                onClick={handleAddEvent}
                className="w-full py-2 bg-primary text-white rounded-lg hover:bg-primary/90"
              >
                Thêm sự kiện
              </button>
            </div>
          )}
          
          <div className="divide-y divide-gray-200 dark:divide-gray-700">
            {events.length === 0 ? (
              <div className="py-4 text-center text-gray-500 dark:text-gray-400">
                Không có sự kiện nào. Thêm sự kiện mới để bắt đầu.
              </div>
            ) : (
              events.map(event => (
                <div key={event.id} className="py-3 animate-fadeIn">
                  <div className="flex items-start justify-between">
                    <div className="font-medium">{event.title}</div>
                    <button 
                      onClick={() => deleteEvent(event.id)}
                      className="text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400"
                    >
                      <i className="fas fa-trash-alt"></i>
                    </button>
                  </div>
                  
                  <div className="text-sm text-gray-600 dark:text-gray-400">
                    {event.description}
                  </div>
                  
                  <div className="mt-2 grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400">
                    <div>
                      <i className="far fa-clock mr-1"></i>
                      {dayjs(event.startDate).format('HH:mm, DD/MM/YYYY')}
                    </div>
                    
                    <div>
                      <i className="far fa-clock mr-1"></i>
                      {dayjs(event.endDate).format('HH:mm, DD/MM/YYYY')}
                    </div>
                    
                    {event.location && (
                      <div className="col-span-2">
                        <i className="fas fa-map-marker-alt mr-1"></i>
                        {event.location}
                      </div>
                    )}
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      );
      
      // Render AI Assistant
      const renderAiAssistant = () => (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4 animate-fadeIn">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-semibold">Trợ lý thông minh</h2>
            <button 
              onClick={getAiSuggestions}
              disabled={isAiLoading}
              className={`px-3 py-1 rounded flex items-center ${isAiLoading ? 'bg-gray-400 text-gray-200' : 'bg-primary text-white'}`}
            >
              {isAiLoading ? (
                <>
                  <i className="fas fa-spinner fa-spin mr-1"></i>
                  Đang xử lý...
                </>
              ) : (
                <>
                  <i className="fas fa-magic mr-1"></i>
                  Tối ưu lịch trình
                </>
              )}
            </button>
          </div>
          
          <div className="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div className="flex mb-3 items-center">
              <img 
                src="https://i.imgur.com/vqZpK07.png" 
                alt="AI Assistant" 
                className="w-8 h-8 rounded-full mr-2" 
              />
              <div className="text-sm font-medium">Trợ lý lịch trình</div>
            </div>
            
            <div 
              className="prose prose-sm max-w-none dark:prose-invert p-2 bg-white dark:bg-gray-800 rounded min-h-24"
              dangerouslySetInnerHTML={{ 
                __html: isAiLoading && !aiAssistantResponse 
                  ? '<div class="flex justify-center items-center h-20"><i class="fas fa-spinner fa-spin text-xl text-primary"></i></div>' 
                  : aiAssistantResponse 
                    ? marked.parse(aiAssistantResponse) 
                    : 'Nhấn nút "Tối ưu lịch trình" để nhận đề xuất sắp xếp công việc hiệu quả dựa trên thói quen, ưu tiên và thời gian của bạn.'
              }}
            ></div>
            
            <div className="mt-3 flex flex-wrap gap-2">
              <button className="px-3 py-1 text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full">
                Đề xuất thời gian làm việc
              </button>
              <button className="px-3 py-1 text-sm bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-full">
                Cân bằng thời gian
              </button>
              <button className="px-3 py-1 text-sm bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200 rounded-full">
                Đề xuất chống burnout
              </button>
            </div>
          </div>
        </div>
      );
      
      // Render Calendar Sync
      const renderCalendarSync = () => (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4 animate-fadeIn">
          <h2 className="text-xl font-semibold mb-4">Đồng bộ lịch</h2>
          
          <div className="divide-y divide-gray-200 dark:divide-gray-700">
            {syncedCalendars.map(calendar => (
              <div key={calendar.id} className="py-3 flex items-center justify-between">
                <div className="flex items-center">
                  <div 
                    className="w-4 h-4 rounded-full mr-3" 
                    style={{ backgroundColor: calendar.color }}
                  ></div>
                  <span>{calendar.name}</span>
                </div>
                
                <div className="flex items-center">
                  <span className={`text-xs px-2 py-0.5 rounded-full mr-2 ${calendar.connected ? 'bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'}`}>
                    {calendar.connected ? 'Đã kết nối' : 'Chưa kết nối'}
                  </span>
                  
                  <button className="px-3 py-1 bg-primary text-white rounded text-sm">
                    {calendar.connected ? 'Cài đặt' : 'Kết nối'}
                  </button>
                </div>
              </div>
            ))}
            
            <div className="py-3">
              <button className="w-full py-2 text-center border border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                <i className="fas fa-plus mr-1"></i>
                Thêm lịch mới
              </button>
            </div>
          </div>
        </div>
      );
      
      return (
        <div className="min-h-screen pb-16 md:pb-0">
          {/* Header */}
          <header className="bg-white dark:bg-gray-800 shadow-md">
            <div className="container mx-auto px-4 py-3">
              <div className="flex items-center justify-between">
                <div className="flex items-center">
                  <img src="https://i.imgur.com/vqZpK07.png" alt="Logo" className="w-10 h-10 mr-3" />
                  <h1 className="text-xl font-bold text-primary">SmartScheduler</h1>
                </div>
                
                <div className="flex items-center">
                  <button 
                    onClick={toggleDarkMode} 
                    className="p-2 rounded-full mr-2 hover:bg-gray-200 dark:hover:bg-gray-700"
                  >
                    <i className={`fas ${isDarkMode ? 'fa-sun' : 'fa-moon'}`}></i>
                  </button>
                  
                  <div className="relative mr-2">
                    <button className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 relative">
                      <i className="fas fa-bell"></i>
                      {notifications.filter(n => !n.read).length > 0 && (
                        <span className="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                      )}
                    </button>
                  </div>
                  
                  <button 
                    onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                    className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 md:hidden"
                  >
                    <i className={`fas ${isMobileMenuOpen ? 'fa-times' : 'fa-bars'}`}></i>
                  </button>
                </div>
              </div>
            </div>
          </header>
          
          {/* Mobile Menu */}
          {isMobileMenuOpen && (
            <div className="fixed inset-0 z-50 bg-black bg-opacity-50" onClick={() => setIsMobileMenuOpen(false)}>
              <div className="absolute right-0 top-0 bottom-0 w-64 bg-white dark:bg-gray-800 shadow-lg animate-fadeIn" onClick={e => e.stopPropagation()}>
                <div className="p-4 border-b dark:border-gray-700">
                  <h2 className="text-lg font-semibold">Menu</h2>
                </div>
                
                <div className="p-2">
                  <button 
                    onClick={() => {
                      setActiveTab('tasks');
                      setIsMobileMenuOpen(false);
                    }} 
                    className={`w-full text-left p-3 rounded-lg mb-1 ${activeTab === 'tasks' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                  >
                    <i className="fas fa-tasks mr-2"></i>
                    Công việc
                  </button>
                  
                  <button 
                    onClick={() => {
                      setActiveTab('calendar');
                      setIsMobileMenuOpen(false);
                    }} 
                    className={`w-full text-left p-3 rounded-lg mb-1 ${activeTab === 'calendar' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                  >
                    <i className="fas fa-calendar-alt mr-2"></i>
                    Lịch
                  </button>
                  
                  <button 
                    onClick={() => {
                      setActiveTab('ai');
                      setIsMobileMenuOpen(false);
                    }} 
                    className={`w-full text-left p-3 rounded-lg mb-1 ${activeTab === 'ai' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                  >
                    <i className="fas fa-robot mr-2"></i>
                    Trợ lý AI
                  </button>
                  
                  <button 
                    onClick={() => {
                      setActiveTab('sync');
                      setIsMobileMenuOpen(false);
                    }} 
                    className={`w-full text-left p-3 rounded-lg mb-1 ${activeTab === 'sync' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                  >
                    <i className="fas fa-sync mr-2"></i>
                    Đồng bộ
                  </button>
                  
                  <div className="border-t dark:border-gray-700 my-2 pt-2">
                    <button 
                      onClick={startListening}
                      className="w-full flex items-center justify-center p-3 bg-primary text-white rounded-lg pulse-animation"
                    >
                      <i className="fas fa-microphone mr-2"></i>
                      Ra lệnh bằng giọng nói
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
          
          {/* Main content */}
          <main className="container mx-auto px-4 py-4">
            <div className="lg:grid lg:grid-cols-5 lg:gap-4">
              {/* Left sidebar (desktop only) */}
              <div className="hidden md:block md:col-span-1">
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                  <div className="space-y-1">
                    <button 
                      onClick={() => setActiveTab('tasks')} 
                      className={`w-full text-left p-3 rounded-lg ${activeTab === 'tasks' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                    >
                      <i className="fas fa-tasks mr-2"></i>
                      Công việc
                    </button>
                    
                    <button 
                      onClick={() => setActiveTab('calendar')} 
                      className={`w-full text-left p-3 rounded-lg ${activeTab === 'calendar' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                    >
                      <i className="fas fa-calendar-alt mr-2"></i>
                      Lịch
                    </button>
                    
                    <button 
                      onClick={() => setActiveTab('ai')} 
                      className={`w-full text-left p-3 rounded-lg ${activeTab === 'ai' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                    >
                      <i className="fas fa-robot mr-2"></i>
                      Trợ lý AI
                    </button>
                    
                    <button 
                      onClick={() => setActiveTab('sync')} 
                      className={`w-full text-left p-3 rounded-lg ${activeTab === 'sync' ? 'bg-primary text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                    >
                      <i className="fas fa-sync mr-2"></i>
                      Đồng bộ
                    </button>
                  </div>
                  
                  <div className="mt-4">
                    <button 
                      onClick={startListening}
                      className={`w-full flex items-center justify-center p-3 bg-primary text-white rounded-lg ${isListening ? 'pulse-animation' : ''}`}
                      disabled={isListening}
                    >
                      {isListening ? (
                        <>
                          <i className="fas fa-microphone-alt mr-2"></i>
                          Đang nghe...
                        </>
                      ) : (
                        <>
                          <i className="fas fa-microphone mr-2"></i>
                          Ra lệnh bằng giọng nói
                        </>
                      )}
                    </button>
                  </div>
                </div>
                
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                  <h3 className="font-medium mb-2">Thông báo mới</h3>
                  
                  <div className="space-y-2 max-h-60 overflow-y-auto">
                    {notifications.length === 0 ? (
                      <div className="text-sm text-gray-500 dark:text-gray-400 text-center py-2">
                        Không có thông báo mới
                      </div>
                    ) : (
                      notifications.map(notification => (
                        <div 
                          key={notification.id} 
                          className={`p-2 text-sm rounded-lg ${notification.read ? 'bg-gray-100 dark:bg-gray-700' : 'bg-blue-50 dark:bg-blue-900/20 border-l-2 border-primary'}`}
                        >
                          <div className="font-medium">{notification.title}</div>
                          <div className="text-xs text-gray-600 dark:text-gray-400">{notification.time}</div>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
              
              {/* Main content area */}
              <div className="lg:col-span-4">
                {activeTab === 'tasks' && (
                  <>
                    {renderCalendar()}
                    {renderTasks()}
                    {renderEvents()}
                  </>
                )}
                
                {activeTab === 'calendar' && (
                  <>
                    {renderCalendar()}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>{renderTasks()}</div>
                      <div>{renderEvents()}</div>
                    </div>
                  </>
                )}
                
                {activeTab === 'ai' && (
                  <>
                    {renderAiAssistant()}
                    {renderCalendar()}
                    {renderTasks()}
                  </>
                )}
                
                {activeTab === 'sync' && (
                  <>
                    {renderCalendarSync()}
                    {renderCalendar()}
                  </>
                )}
              </div>
            </div>
          </main>
          
          {/* Mobile bottom navigation */}
          <nav className="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t dark:border-gray-700 md:hidden">
            <div className="grid grid-cols-4">
              <button 
                onClick={() => setActiveTab('tasks')}
                className={`p-3 flex flex-col items-center ${activeTab === 'tasks' ? 'text-primary' : 'text-gray-600 dark:text-gray-400'}`}
              >
                <i className="fas fa-tasks text-lg"></i>
                <span className="text-xs mt-1">Công việc</span>
              </button>
              
              <button 
                onClick={() => setActiveTab('calendar')}
                className={`p-3 flex flex-col items-center ${activeTab === 'calendar' ? 'text-primary' : 'text-gray-600 dark:text-gray-400'}`}
              >
                <i className="fas fa-calendar-alt text-lg"></i>
                <span className="text-xs mt-1">Lịch</span>
              </button>
              
              <button 
                onClick={() => setActiveTab('ai')}
                className={`p-3 flex flex-col items-center ${activeTab === 'ai' ? 'text-primary' : 'text-gray-600 dark:text-gray-400'}`}
              >
                <i className="fas fa-robot text-lg"></i>
                <span className="text-xs mt-1">Trợ lý</span>
              </button>
              
              <button 
                onClick={() => setActiveTab('sync')}
                className={`p-3 flex flex-col items-center ${activeTab === 'sync' ? 'text-primary' : 'text-gray-600 dark:text-gray-400'}`}
              >
                <i className="fas fa-sync text-lg"></i>
                <span className="text-xs mt-1">Đồng bộ</span>
              </button>
            </div>
          </nav>
        </div>
      );
    };
    
    // Render the app
    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);
  </script>
</body>
</html>
